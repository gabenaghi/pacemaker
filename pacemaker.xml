<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>// Place global declarations here.
clock clk;
int TLRI = 25;
int TURI = 10;
int TAVI = 4;
int TPVARP = 3;
int TVRP = 4;
int minwait_A = 10;
int minwait_V = 10;

// Heart sensing signals
chan Asense;
chan Vsense;

// Heart pacing signals
chan Apace;
chan Vpace;
chan Aget;
chan Vget;

// Speaker
chan StopHigh;
chan StopLow;
chan PlayHigh;
chan PlayLow;

// LEDs
chan LEDon[4];
chan LEDoff[4];

// Keyboard
chan forceApace;
chan forceVpace;

// Heart rate
int obs_interval = 1000;

const int LED_VSENSE = 0;
const int LED_VGET = 1;
const int LED_ASENSE = 2;
const int LED_AGET = 3;
</declaration><template><name x="5" y="5">LRI</name><declaration>// Place local declarations here.
clock t;</declaration><location id="id0" x="-96" y="-104"><committed/></location><location id="id1" x="264" y="96"><committed/></location><location id="id2" x="0" y="-104"><name x="-24" y="-136">ASed</name></location><location id="id3" x="120" y="24"><name x="152" y="16">LRI</name><label kind="invariant" x="192" y="16">t &lt;= TLRI - TAVI</label></location><init ref="id3"/><transition><source ref="id1"/><target ref="id3"/><label kind="synchronisation" x="200" y="96">Apace!</label><label kind="assignment" x="200" y="112">t = 0</label><nail x="176" y="96"/></transition><transition><source ref="id3"/><target ref="id1"/><label kind="synchronisation" x="192" y="40">forceApace?</label></transition><transition><source ref="id0"/><target ref="id3"/><label kind="synchronisation" x="-144" y="-64">Apace!</label><label kind="assignment" x="-128" y="-48">t = 0</label><nail x="-96" y="24"/></transition><transition><source ref="id2"/><target ref="id0"/><label kind="synchronisation" x="-112" y="-136">forceApace?</label></transition><transition><source ref="id3"/><target ref="id3"/><label kind="synchronisation" x="176" y="-112">Vpace?</label><label kind="assignment" x="184" y="-96">t = 0</label><nail x="144" y="-72"/><nail x="216" y="-72"/><nail x="216" y="-16"/></transition><transition><source ref="id3"/><target ref="id3"/><label kind="synchronisation" x="96" y="144">Vsense?</label><label kind="assignment" x="112" y="160">t = 0</label><nail x="80" y="96"/><nail x="120" y="144"/><nail x="160" y="96"/></transition><transition><source ref="id2"/><target ref="id3"/><label kind="synchronisation" x="40" y="-80">Vpace?</label><label kind="assignment" x="56" y="-64">t = 0</label></transition><transition><source ref="id2"/><target ref="id3"/><label kind="synchronisation" x="-40" y="-24">Vsense?</label><label kind="assignment" x="-8" y="-8">t = 0</label><nail x="0" y="-32"/><nail x="56" y="24"/></transition><transition><source ref="id3"/><target ref="id2"/><label kind="synchronisation" x="48" y="-128">Asense?</label><nail x="120" y="-72"/><nail x="88" y="-104"/></transition><transition><source ref="id3"/><target ref="id3"/><label kind="guard" x="-112" y="64">t &gt;= TLRI - TAVI</label><label kind="synchronisation" x="-56" y="80">Apace!</label><label kind="assignment" x="-48" y="96">t = 0</label><nail x="64" y="72"/><nail x="40" y="96"/><nail x="40" y="96"/><nail x="16" y="96"/><nail x="0" y="96"/><nail x="0" y="56"/></transition></template><template><name>AVI</name><declaration>clock t;
</declaration><location id="id4" x="-472" y="144"><committed/></location><location id="id5" x="72" y="168"><committed/></location><location id="id6" x="88" y="-232"><committed/></location><location id="id7" x="-160" y="144"><name x="-160" y="112">WaitURI</name><label kind="invariant" x="-208" y="160">clk &lt;= TURI</label></location><location id="id8" x="-8" y="64"><name x="-18" y="34">AVI</name><label kind="invariant" x="-24" y="72">t &lt;= TAVI</label></location><location id="id9" x="-8" y="-136"><name x="32" y="-160">Idle</name></location><init ref="id9"/><transition><source ref="id4"/><target ref="id9"/><label kind="synchronisation" x="-528" y="-16">Vpace!</label><nail x="-472" y="-144"/></transition><transition><source ref="id7"/><target ref="id4"/><label kind="synchronisation" x="-408" y="120">forceVpace?</label></transition><transition><source ref="id5"/><target ref="id9"/><label kind="synchronisation" x="208" y="-72">Vpace!</label><nail x="288" y="168"/><nail x="256" y="-136"/></transition><transition><source ref="id8"/><target ref="id5"/><label kind="synchronisation" x="40" y="112">forceVpace?</label></transition><transition><source ref="id6"/><target ref="id9"/><label kind="synchronisation" x="120" y="-192">Vpace!</label><nail x="192" y="-232"/></transition><transition><source ref="id9"/><target ref="id6"/><label kind="synchronisation" x="-16" y="-216">forceVpace?</label></transition><transition><source ref="id7"/><target ref="id9"/><label kind="synchronisation" x="-408" y="8">Vsense?</label><nail x="-240" y="144"/><nail x="-344" y="104"/><nail x="-344" y="-136"/><nail x="-160" y="-232"/><nail x="-40" y="-232"/><nail x="-8" y="-184"/></transition><transition><source ref="id7"/><target ref="id9"/><label kind="guard" x="-296" y="56">clk &gt;= TURI</label><label kind="synchronisation" x="-272" y="72">Vpace!</label><nail x="-216" y="112"/><nail x="-216" y="-104"/><nail x="-112" y="-176"/><nail x="-48" y="-176"/></transition><transition><source ref="id8"/><target ref="id7"/><label kind="guard" x="-120" y="136">t &gt;= TAVI &amp;&amp; clk &lt; TURI</label><nail x="-72" y="80"/><nail x="-96" y="136"/></transition><transition><source ref="id8"/><target ref="id9"/><label kind="guard" x="64" y="64">t &gt;= TAVI &amp;&amp; clk &gt;= TURI</label><label kind="synchronisation" x="96" y="48">Vpace!</label><nail x="64" y="64"/><nail x="128" y="8"/><nail x="128" y="-96"/><nail x="80" y="-136"/></transition><transition><source ref="id8"/><target ref="id9"/><label kind="synchronisation" x="-168" y="40">Vsense?</label><nail x="-88" y="64"/><nail x="-144" y="8"/><nail x="-144" y="-80"/><nail x="-80" y="-136"/></transition><transition><source ref="id9"/><target ref="id8"/><label kind="synchronisation" x="-16" y="-56">Asense?</label><label kind="assignment" x="-8" y="-40">t = 0</label><nail x="40" y="-96"/><nail x="40" y="24"/></transition><transition><source ref="id9"/><target ref="id8"/><label kind="synchronisation" x="-112" y="-56">Apace?</label><label kind="assignment" x="-104" y="-40">t = 0</label><nail x="-56" y="-96"/><nail x="-56" y="-96"/><nail x="-56" y="32"/></transition></template><template><name>URI</name><declaration>clock t;
</declaration><location id="id10" x="0" y="0"><name x="-16" y="16">URI</name></location><init ref="id10"/><transition><source ref="id10"/><target ref="id10"/><label kind="synchronisation" x="136" y="-8">Vsense?</label><label kind="assignment" x="136" y="8">clk = 0</label><nail x="40" y="48"/><nail x="96" y="48"/><nail x="128" y="16"/><nail x="128" y="-24"/><nail x="96" y="-56"/><nail x="48" y="-56"/></transition><transition><source ref="id10"/><target ref="id10"/><label kind="synchronisation" x="-192" y="-8">Vpace?</label><label kind="assignment" x="-192" y="8">clk = 0</label><nail x="-48" y="48"/><nail x="-104" y="48"/><nail x="-136" y="16"/><nail x="-136" y="-24"/><nail x="-104" y="-56"/><nail x="-48" y="-56"/></transition></template><template><name x="5" y="5">PVARP</name><declaration>// Place local declarations here.
clock t;
</declaration><location id="id11" x="112" y="-32"><name x="120" y="-64">PVARP</name><label kind="invariant" x="128" y="-40">t&lt;=TPVARP</label></location><location id="id12" x="-200" y="88"><name x="-248" y="80">inter</name><committed/></location><location id="id13" x="-200" y="-32"><name x="-248" y="-48">Idle</name></location><init ref="id13"/><transition><source ref="id13"/><target ref="id11"/><label kind="synchronisation" x="-72" y="-88">Vpace?</label><label kind="assignment" x="-64" y="-72">t = 0</label><nail x="-96" y="-88"/><nail x="8" y="-88"/></transition><transition><source ref="id13"/><target ref="id11"/><label kind="synchronisation" x="-72" y="16">Vsense?</label><label kind="assignment" x="-64" y="32">t = 0</label><nail x="-104" y="16"/><nail x="8" y="16"/></transition><transition><source ref="id11"/><target ref="id13"/><label kind="guard" x="-88" y="-168">t&gt;=TPVARP</label><nail x="112" y="-144"/><nail x="-200" y="-144"/></transition><transition><source ref="id12"/><target ref="id13"/><label kind="synchronisation" x="-136" y="96">Asense!</label><nail x="-128" y="88"/></transition><transition><source ref="id13"/><target ref="id12"/><label kind="synchronisation" x="-256" y="32">Aget?</label></transition></template><template><name>VRP</name><declaration>clock t;
</declaration><location id="id14" x="112" y="-96"><name x="102" y="-126">VRP</name><label kind="invariant" x="128" y="-104">t&lt;=TVRP</label></location><location id="id15" x="-144" y="-96"><name x="-154" y="-126">inter</name><committed/></location><location id="id16" x="-144" y="88"><name x="-192" y="80">Idle</name></location><init ref="id16"/><transition><source ref="id14"/><target ref="id16"/><label kind="guard" x="-24" y="96">t&gt;=TVRP</label><nail x="112" y="88"/></transition><transition><source ref="id16"/><target ref="id14"/><label kind="synchronisation" x="-76" y="-19">Vpace?</label><label kind="assignment" x="-76" y="-4">t=0</label></transition><transition><source ref="id15"/><target ref="id14"/><label kind="synchronisation" x="-76" y="-111">Vsense!</label><label kind="assignment" x="-76" y="-96">t=0</label></transition><transition><source ref="id16"/><target ref="id15"/><label kind="synchronisation" x="-204" y="-19">Vget?</label></transition></template><template><name>LED</name><parameter>const int id</parameter><location id="id17" x="-320" y="0"><name x="-330" y="-30">on</name></location><location id="id18" x="-504" y="88"><name x="-514" y="58">off</name></location><init ref="id18"/><transition><source ref="id17"/><target ref="id17"/><label kind="synchronisation" x="-440" y="-56">LEDon[id]?</label><nail x="-376" y="-72"/><nail x="-264" y="-72"/></transition><transition><source ref="id17"/><target ref="id18"/><label kind="synchronisation" x="-368" y="64">LEDoff[id]?</label><nail x="-400" y="88"/></transition><transition><source ref="id18"/><target ref="id17"/><label kind="synchronisation" x="-544" y="8">LEDon[id]?</label><nail x="-440" y="0"/></transition><transition><source ref="id18"/><target ref="id18"/><label kind="synchronisation" x="-456" y="136">LEDoff[id]?</label><nail x="-552" y="152"/><nail x="-464" y="152"/></transition></template><template><name>Speaker</name><location id="id19" x="8" y="112"><name x="32" y="120">playingLow</name></location><location id="id20" x="16" y="-104"><name x="40" y="-128">playingHigh</name></location><location id="id21" x="-176" y="0"><name x="-216" y="-8">Idle</name></location><init ref="id21"/><transition><source ref="id21"/><target ref="id21"/><label kind="synchronisation" x="-240" y="64">StopLow?</label><nail x="-176" y="40"/><nail x="-176" y="64"/><nail x="-240" y="64"/></transition><transition><source ref="id21"/><target ref="id21"/><label kind="synchronisation" x="-240" y="-88">StopHigh?</label><nail x="-176" y="-64"/><nail x="-248" y="-64"/></transition><transition><source ref="id19"/><target ref="id19"/><label kind="synchronisation" x="80" y="80">StopHigh?</label><nail x="80" y="112"/><nail x="80" y="56"/></transition><transition><source ref="id20"/><target ref="id20"/><label kind="synchronisation" x="88" y="-88">StopLow?</label><nail x="80" y="-104"/><nail x="80" y="-48"/></transition><transition><source ref="id19"/><target ref="id19"/><label kind="synchronisation" x="-16" y="144">PlayLow?</label><nail x="-16" y="144"/><nail x="40" y="144"/></transition><transition><source ref="id20"/><target ref="id20"/><label kind="synchronisation" x="-8" y="-160">PlayHigh?</label><nail x="-16" y="-136"/><nail x="48" y="-136"/></transition><transition><source ref="id20"/><target ref="id21"/><label kind="synchronisation" x="-120" y="-112">StopHigh?</label><nail x="-128" y="-88"/></transition><transition><source ref="id19"/><target ref="id21"/><label kind="synchronisation" x="-104" y="112">StopLow?</label><nail x="-136" y="104"/></transition><transition><source ref="id19"/><target ref="id20"/><label kind="synchronisation" x="80" y="0">PlayHigh?</label><nail x="16" y="104"/><nail x="64" y="0"/></transition><transition><source ref="id20"/><target ref="id19"/><label kind="synchronisation" x="-104" y="-8">PlayLow?</label><nail x="-40" y="0"/></transition><transition><source ref="id21"/><target ref="id19"/><label kind="synchronisation" x="-120" y="64">PlayLow?</label></transition><transition><source ref="id21"/><target ref="id20"/><label kind="synchronisation" x="-136" y="-72">PlayHigh?</label></transition></template><template><name>Heart</name><declaration>clock x;</declaration><location id="id22" x="0" y="0"></location><init ref="id22"/><transition><source ref="id22"/><target ref="id22"/><label kind="synchronisation" x="-24" y="152">Apace?</label><label kind="assignment" x="-16" y="168">x = 0</label><nail x="24" y="80"/><nail x="0" y="152"/><nail x="-32" y="80"/></transition><transition><source ref="id22"/><target ref="id22"/><label kind="synchronisation" x="176" y="-32">Vpace?</label><label kind="assignment" x="184" y="-16">x = 0</label><nail x="80" y="-24"/><nail x="160" y="0"/><nail x="80" y="24"/></transition><transition><source ref="id22"/><target ref="id22"/><label kind="guard" x="-40" y="-224">x &gt;= minwait_V</label><label kind="synchronisation" x="-8" y="-208">Vget!</label><label kind="assignment" x="-8" y="-192">x = 0</label><nail x="-32" y="-80"/><nail x="0" y="-160"/><nail x="40" y="-80"/></transition><transition><source ref="id22"/><target ref="id22"/><label kind="guard" x="-248" y="-32">x &gt;= minwait_A</label><label kind="synchronisation" x="-208" y="-16">Aget!</label><label kind="assignment" x="-208" y="0">x = 0</label><nail x="-72" y="32"/><nail x="-152" y="8"/><nail x="-72" y="-24"/></transition></template><template><name>Keyboard</name><declaration>bool manual;
clock t;</declaration><location id="id23" x="0" y="0"><name x="-56" y="0">Idle</name></location><init ref="id23"/><transition><source ref="id23"/><target ref="id23"/><label kind="guard" x="96" y="32">t &gt;= 1000</label><label kind="assignment" x="96" y="48">t = 0,
obs_interval = 1000</label><nail x="88" y="40"/><nail x="80" y="80"/><nail x="24" y="72"/></transition><transition><source ref="id23"/><target ref="id23"/><label kind="guard" x="192" y="-32">t &gt;= 1000</label><label kind="assignment" x="192" y="-16">t = 0,
obs_interval = 100</label><nail x="96" y="-24"/><nail x="184" y="0"/><nail x="88" y="16"/></transition><transition><source ref="id23"/><target ref="id23"/><label kind="guard" x="-240" y="56">t&gt;=1000 &amp;&amp; manual</label><label kind="synchronisation" x="-240" y="72">forceVpace!</label><label kind="assignment" x="-240" y="88">t = 0</label><nail x="-136" y="136"/><nail x="-88" y="56"/></transition><transition><source ref="id23"/><target ref="id23"/><label kind="guard" x="-272" y="-48">t&gt;=1000 &amp;&amp; manual</label><label kind="synchronisation" x="-272" y="-16">forceApace!</label><label kind="assignment" x="-272" y="-32">t = 0</label><nail x="-216" y="0"/><nail x="-104" y="-24"/></transition><transition><source ref="id23"/><target ref="id23"/><label kind="guard" x="-216" y="-200">t&gt;=1000</label><label kind="assignment" x="-216" y="-184">TURI = 6,
t = 0,
TLRI = 33,
manual = true</label><nail x="-144" y="-144"/><nail x="-48" y="-96"/></transition><transition><source ref="id23"/><target ref="id23"/><label kind="guard" x="16" y="-232">t &gt;= 1000</label><label kind="assignment" x="16" y="-216">t = 0,
TURI = 6,
TLRI = 10,
manual = false</label><label kind="comments">Sports mode</label><nail x="-32" y="-112"/><nail x="-8" y="-200"/><nail x="32" y="-112"/></transition><transition><source ref="id23"/><target ref="id23"/><label kind="guard" x="-8" y="96">t &gt;= 1000</label><label kind="assignment" x="-8" y="112">t = 0,
TURI = 17,
TLRI = 33,
manual = false</label><label kind="comments">Sleep mode</label><nail x="-16" y="88"/><nail x="-72" y="160"/><nail x="-64" y="80"/></transition><transition><source ref="id23"/><target ref="id23"/><label kind="guard" x="104" y="-136">t &gt;= 1000</label><label kind="assignment" x="104" y="-120">t = 0,
TURI = 10,
TLRI = 25,
manual = false</label><label kind="comments">Normal mode</label><nail x="40" y="-104"/><nail x="96" y="-120"/><nail x="88" y="-64"/></transition></template><template><name>HeartRateDisplay</name><declaration>clock t;
int A = 0;
int V = 0;
int displayed_rate = 0;</declaration><location id="id24" x="0" y="0"></location><init ref="id24"/><transition><source ref="id24"/><target ref="id24"/><label kind="guard" x="152" y="48">t &gt;= obs_interval</label><label kind="assignment" x="152" y="64">t = 0,
displayed_rate = V / (obs_interval / 60),
V = 0,
A = 0</label><nail x="144" y="64"/><nail x="48" y="56"/></transition><transition><source ref="id24"/><target ref="id24"/><label kind="synchronisation" x="144" y="-72">Apace?</label><label kind="assignment" x="152" y="-56">A++</label><nail x="136" y="-64"/><nail x="80" y="0"/></transition><transition><source ref="id24"/><target ref="id24"/><label kind="synchronisation" x="-72" y="-152">Asense?</label><label kind="assignment" x="-56" y="-136">A++</label><nail x="-80" y="-128"/><nail x="-8" y="-72"/></transition><transition><source ref="id24"/><target ref="id24"/><label kind="synchronisation" x="-216" y="0">Vpace?</label><label kind="assignment" x="-208" y="16">V++</label><nail x="-168" y="24"/><nail x="-88" y="-16"/></transition><transition><source ref="id24"/><target ref="id24"/><label kind="synchronisation" x="-72" y="144">Vsense?</label><label kind="assignment" x="-56" y="160">V++</label><nail x="-48" y="144"/><nail x="-56" y="56"/></transition></template><system>// Place template instantiations here.
lri = LRI();
avi = AVI();
uri = URI();
pvarp = PVARP();
vrp = VRP();
led_vsense = LED(LED_VSENSE);
led_vget = LED(LED_VGET);
led_asense = LED(LED_ASENSE);
led_aget = LED(LED_AGET);
heart = Heart();

// List one or more processes to be composed into a system.
system lri, avi, uri, pvarp, vrp, led_vsense, led_vget, led_asense, led_aget, heart;
</system></nta>